<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Downloader By Zidan Dev</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
*{box-sizing:border-box;font-family:Segoe UI}
body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:linear-gradient(135deg,#667eea,#764ba2);
}
.container{
  background:#fff;
  width:100%;
  max-width:600px;
  padding:30px;
  border-radius:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.25)
}
h1{text-align:center;color:#667eea;margin-bottom:10px}
p{text-align:center;color:#666;margin-bottom:25px}

input{
  width:100%;
  padding:15px;
  border-radius:10px;
  border:2px solid #ddd;
  font-size:1rem
}
button{
  width:100%;
  margin-top:15px;
  padding:15px;
  border:none;
  border-radius:10px;
  background:linear-gradient(to right,#667eea,#764ba2);
  color:#fff;
  font-size:1.1rem;
  cursor:pointer
}

.loading{
  display:none;
  text-align:center;
  margin-top:20px
}
.result{
  display:none;
  margin-top:25px;
  background:#f8f9fa;
  padding:20px;
  border-radius:15px
}
.result img{
  width:100%;
  border-radius:10px;
  margin-bottom:15px
}
.opt{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#fff;
  padding:12px;
  border-radius:10px;
  margin-top:10px
}
.opt a{
  background:#667eea;
  color:#fff;
  padding:8px 14px;
  border-radius:7px;
  text-decoration:none
}
.error{
  display:none;
  background:#ffebee;
  color:#c62828;
  padding:12px;
  border-radius:10px;
  margin-top:15px;
  text-align:center
}
footer{
  margin-top:20px;
  text-align:center;
  color:#999;
  font-size:.9rem
}
</style>
</head>

<body>

<div class="container">
  <h1><i class="fas fa-download"></i> Downloader</h1>
  <p>Instagram & TikTok Downloader</p>

  <input id="url" placeholder="Tempel link Instagram / TikTok">
  <button onclick="download()">Download</button>

  <div class="loading" id="loading">‚è≥ Mengambil data...</div>
  <div class="error" id="error"></div>

  <div class="result" id="result">
    <img id="thumb">
    <div id="options"></div>
  </div>

  <footer>¬© Zidan Dev</footer>
</div>

<script>
async function download(){
  const url = document.getElementById("url").value.trim();
  if(!url) return showError("URL tidak boleh kosong");

  hideError();
  showLoading(true);

  const type = url.includes("tiktok") ? "TikTok" : "Instagram";

  /* üîî NOTIF TELEGRAM */
  fetch("/api/notify",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      domain: location.hostname,
      type,
      link: url
    })
  });

  try{
    const res = await fetch(`/api/download?url=${encodeURIComponent(url)}`);
    const json = await res.json();

    if(!json.status || !json.data?.length){
      throw "Video tidak ditemukan";
    }

    const v = json.data[0];
    showResult(v.thumbnail, v.url);

  }catch(e){
    showError(typeof e === "string" ? e : "Terjadi kesalahan");
  }finally{
    showLoading(false);
  }
}

function showResult(thumb, video){
  document.getElementById("result").style.display="block";
  document.getElementById("thumb").src = thumb;

  document.getElementById("options").innerHTML = `
    <div class="opt">
      <span>Video MP4</span>
      <a href="${video}" target="_blank">Download</a>
    </div>
  `;
}

function showLoading(s){
  document.getElementById("loading").style.display = s ? "block" : "none";
}
function showError(t){
  const e=document.getElementById("error");
  e.style.display="block";
  e.innerText=t;
}
function hideError(){
  document.getElementById("error").style.display="none";
}
</script>

</body>
</html>
